#!/usr/bin/env bash
set -euo pipefail
: "${ADM_SCRIPTS:=/usr/src/adm/scripts}"
ADM_MKINIT="${ADM_SCRIPTS}/adm-mkinitramfs"

# Detectar versÃ£o instalada (pelo /lib/modules do sistema real)
KVER="$(ls -1 /lib/modules 2>/dev/null | sort -V | tail -n1 || true)"
[[ -z "$KVER" ]] && exit 0

# Gerar initramfs para este kernel
if [[ -x "$ADM_MKINIT" ]]; then
  "$ADM_MKINIT" --kver="$KVER" --hostonly --compress=zstd || "$ADM_MKINIT" --kver="$KVER" --compress=zstd || true
fi
