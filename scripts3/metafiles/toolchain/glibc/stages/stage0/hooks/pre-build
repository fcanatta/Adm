#!/usr/bin/env bash
# glibc stage0 pre-build
set -euo pipefail
echo "[glibc stage0 pre-build] preparando ambiente e aplicando patch FHS..."

if [ -f "${WORKDIR}/../glibc-2.42-fhs-1.patch" ]; then
  patch -Np1 -i "${WORKDIR}/../glibc-2.42-fhs-1.patch"
fi

case $(uname -m) in
  i?86) ln -sfv ld-linux.so.2 "$LFS/lib/ld-lsb.so.3" ;;
  x86_64)
    mkdir -pv "$LFS/lib64"
    ln -sfv ../lib/ld-linux-x86-64.so.2 "$LFS/lib64"
    ln -sfv ../lib/ld-linux-x86-64.so.2 "$LFS/lib64/ld-lsb-x86-64.so.3" ;;
esac

mkdir -p build && cd build
echo "rootsbindir=/usr/sbin" > configparms

echo "[glibc stage0 pre-build] pronto para compilar."
