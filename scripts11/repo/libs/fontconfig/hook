#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

root() {
  [ -n "${ADM_INSTALL_ROOT:-}" ] && printf '%s' "$ADM_INSTALL_ROOT" ||
  [ -n "${DESTDIR:-}" ]          && printf '%s' "$DESTDIR" ||
  printf '/'
}

adm_hook_post_install() {
  local r; r="$(root)"

  adm_info "Fontconfig: criando diretÃ³rios essenciais..."
  mkdir -p "$r/etc/fonts/conf.d"

  adm_info "Fontconfig: regenerando fc-cache..."
  if [ -x "$r/usr/bin/fc-cache" ]; then
    chroot "$r" fc-cache -f -v >/dev/null 2>&1 || true
  fi

  adm_info "Fontconfig instalado e cache atualizado."
}
