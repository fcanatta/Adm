#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

if ! declare -F adm_info >/dev/null; then
  adm_info(){ echo "[FOP] $*"; }
fi

root() {
  [ -n "${ADM_INSTALL_ROOT:-}" ] && printf '%s' "$ADM_INSTALL_ROOT" ||
  [ -n "${DESTDIR:-}" ]          && printf '%s' "$DESTDIR" ||
  printf '/'
}

adm_hook_pre_build() {
  export ADM_SKIP_DEFAULT_BUILD=1
}

adm_hook_build() {
  :
}

adm_hook_install() {
  local r; r="$(root)"
  mkdir -p "$r/usr/share/fop"

  cp -a ./* "$r/usr/share/fop/"

  mkdir -p "$r/usr/bin"

  cat >"$r/usr/bin/fop" <<EOF
#!/bin/sh
exec /usr/bin/java -cp /usr/share/fop/build/fop.jar org.apache.fop.cli.Main "\$@"
EOF
  chmod +x "$r/usr/bin/fop"
}

adm_hook_post_install() {
  adm_info "FOP instalado com wrapper em /usr/bin/fop."
}
