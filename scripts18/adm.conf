#========================================================
#  /etc/adm.conf - Configuração automática do ADM
#========================================================

# Se o usuário definiu um perfil manualmente, respeitamos isso:
if [[ -n "${ADM_PROFILE:-}" ]]; then
    PROFILE="$ADM_PROFILE"
else
    #==============================
    # DETECÇÃO AUTOMÁTICA DO PERFIL
    #==============================

    # Detecta se estamos dentro do chroot LFS
    if [[ -e "/tools" || -e "/usr/bin/lfs-release" ]]; then
        PROFILE="lfs"
    else
        # Detecta se o LFS está sendo montado em /mnt/lfs
        if mount | grep -q "on /mnt/lfs "; then
            PROFILE="lfs"
        else
            PROFILE="host"
        fi
    fi
fi

#==============================
# PERFIL LFS
#==============================
if [[ "$PROFILE" == "lfs" ]]; then
    echo "ADM: Modo LFS detectado"

    LFS="/mnt/lfs"
    LFS_USER="lfs"
    LFS_GROUP="lfs"

    LFS_SOURCES_DIR="$LFS/sources"
    LFS_TOOLS_DIR="$LFS/tools"
    LFS_LOG_DIR="$LFS/logs"
    LFS_BUILD_SCRIPTS_DIR="$LFS/build-scripts"

    CHROOT_SECURE=1
    ADM_DB_DIR="$LFS/var/adm"

#==============================
# PERFIL HOST
#==============================
elif [[ "$PROFILE" == "host" ]]; then
    echo "ADM: Modo HOST detectado"

    LFS="/"
    LFS_USER="root"
    LFS_GROUP="root"

    LFS_SOURCES_DIR="/usr/src/adm-sources"
    LFS_TOOLS_DIR="/usr/local/adm/tools"
    LFS_LOG_DIR="/var/log/adm"
    LFS_BUILD_SCRIPTS_DIR="/usr/local/adm/build-scripts"

    CHROOT_SECURE=0
    ADM_DB_DIR="/var/adm"

else
    echo "ADM: Perfil inválido: $PROFILE"
    exit 1
fi
