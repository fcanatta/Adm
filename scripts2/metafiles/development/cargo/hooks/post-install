#!/usr/bin/env bash
#
# ADM HOOK: cargo post-install
# - Valida a instalaÃ§Ã£o e registra versÃ£o.
#
set -euo pipefail

echo "ðŸ”§ [cargo post-install] Verificando instalaÃ§Ã£o..."

DRY_RUN="${DRY_RUN:-0}"
DESTDIR="${DESTDIR:-/usr/src/adm/tmp/cargo-destdir}"

if [ "$DRY_RUN" -eq 1 ]; then
  echo "(dry-run) verificaria $DESTDIR/usr/bin/cargo"
  exit 0
fi

if [ ! -x "$DESTDIR/usr/bin/cargo" ]; then
  echo "âŒ Cargo nÃ£o encontrado apÃ³s instalaÃ§Ã£o."
  exit 1
fi

ver="$("$DESTDIR/usr/bin/cargo" --version || echo unknown)"
mkdir -p "$DESTDIR/var/lib/cargo"
echo "$ver" > "$DESTDIR/var/lib/cargo/version"

echo "âœ… [cargo post-install] Cargo $ver instalado com sucesso."
