#!/usr/bin/env bash
# ADM HOOK: binutils post-build
# Testes e verifica√ß√£o ap√≥s make

set -euo pipefail

echo "üîç [binutils post-build] Validando build..."

ADM_STAGE="${ADM_STAGE:-$(cat /etc/adm-stage 2>/dev/null || echo stage3)}"

if [[ "$ADM_STAGE" =~ stage0|stage1 ]]; then
  echo "‚ÑπÔ∏è  Ignorando testes no bootstrap (${ADM_STAGE})"
else
  echo "‚öôÔ∏è  Executando 'make -k check'"
  if [ "${DRY_RUN:-0}" -eq 1 ]; then
    echo "(dry-run) simulando testes"
  else
    make -k check || echo "‚ö†Ô∏è  Alguns testes falharam, continuar com cautela."
  fi
fi

echo "‚úÖ [binutils post-build] Etapa conclu√≠da"
