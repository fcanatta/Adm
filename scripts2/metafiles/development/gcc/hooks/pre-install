#!/usr/bin/env bash
# ADM HOOK: GCC pre-install
# Cria diret√≥rios e prepara ambiente antes de instalar o GCC

set -euo pipefail

echo "üì¶ [GCC pre-install] Preparando DESTDIR..."

DESTDIR="${DESTDIR:-/usr/src/adm/tmp/gcc-destdir}"

mkdir -p "$DESTDIR/usr/bin" "$DESTDIR/usr/lib/gcc" "$DESTDIR/usr/share/info" "$DESTDIR/usr/share/man"

echo "‚úÖ Diret√≥rios criados em $DESTDIR"

# Garantir que vari√°veis de build estejam definidas
: "${PREFIX:=/usr}"
: "${CFLAGS:=}"
: "${LDFLAGS:=}"

echo "‚ÑπÔ∏è  Instalando para prefixo: $PREFIX"

# Apenas simular se dry-run
if [ "${DRY_RUN:-0}" -eq 1 ]; then
  echo "(dry-run) make install DESTDIR=$DESTDIR"
else
  make install DESTDIR="$DESTDIR"
fi
