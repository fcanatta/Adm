#!/usr/bin/env bash
# ADM HOOK: GCC post-install
# Ajusta symlinks e registra a versÃ£o instalada

set -euo pipefail

echo "ðŸ”§ [GCC post-install] Ajustando links e registrando versÃ£o..."

DESTDIR="${DESTDIR:-/usr/src/adm/tmp/gcc-destdir}"
PREFIX="${PREFIX:-/usr}"

# Criar links simbÃ³licos padrÃ£o
ln -sf gcc "$DESTDIR/$PREFIX/bin/cc"
ln -sf g++ "$DESTDIR/$PREFIX/bin/c++"
ln -sf cpp "$DESTDIR/$PREFIX/bin/cpp"

# Detectar versÃ£o instalada
if [ -x "$DESTDIR/$PREFIX/bin/gcc" ]; then
  ver="$("$DESTDIR/$PREFIX/bin/gcc" -dumpversion || echo unknown)"
  echo "$ver" > "$DESTDIR/$PREFIX/lib/gcc/version"
  echo "âœ”ï¸  GCC versÃ£o registrada: $ver"
fi

# Registrar log
echo "[`date -u`] GCC $ver instalado em $DESTDIR" >> "${ADM_LOG:-/usr/src/adm/logs/gcc-install.log}"

# Opcional: limpar arquivos temporÃ¡rios
find "$DESTDIR" -name '*.la' -delete 2>/dev/null || true
echo "ðŸ§¹ Arquivos *.la removidos (limpeza opcional)"

echo "âœ… [GCC post-install] Finalizado com sucesso"
