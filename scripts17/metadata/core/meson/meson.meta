PKG_NAME="meson"
PKG_VERSION="1.9.1"
PKG_RELEASE=1

PKG_SOURCE_URLS=(
  "https://github.com/mesonbuild/meson/releases/download/${PKG_VERSION}/meson-${PKG_VERSION}.tar.gz"
)
PKG_MD5S=(
  "19e0a1091cec23d369dd77d852844195"
)

PKG_UPSTREAM_URL="https://mesonbuild.com"
PKG_GROUPS=("devel" "build-system")
PKG_DEPENDS=("python" "ninja" "glibc")

PKG_BUILD() {
    set -e
    local srcdir="meson-${PKG_VERSION}"
    cd "$srcdir"

    # LFS multilib 8.60: primeiro gera wheel local
    # (sem build isolation/caches e sem deps externos)
    pip3 wheel -w dist --no-cache-dir --no-build-isolation --no-deps "$PWD"
}

PKG_INSTALL() {
    set -e
    local srcdir="meson-${PKG_VERSION}"
    cd "$srcdir"

    DESTDIR="${DESTDIR:-/}"

    # Adaptado para DESTDIR: uso de --root/--prefix no pip3
    pip3 install \
        --no-index --find-links dist meson \
        --root="$DESTDIR" --prefix=/usr

    # Completion bash
    install -vDm644 data/shell-completions/bash/meson \
        "${DESTDIR}/usr/share/bash-completion/completions/meson"

    # Completion zsh
    install -vDm644 data/shell-completions/zsh/_meson \
        "${DESTDIR}/usr/share/zsh/site-functions/_meson"
}
