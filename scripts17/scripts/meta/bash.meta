# Bash-5.3 - LFS 6.4 (Cross Compiling Temporary Tools)
# ----------------------------------------------------
# Instala o bash temporário em $LFS/usr e cria /bin/sh -> bash.
# Variáveis:
#   - BASH_VER, LFS, LFS_TGT

PKG_NAME="bash"

PKG_BUILD() {
    set -e

    : "${BASH_VER:?BASH_VER não definido}"
    : "${LFS:?LFS não definido}"
    : "${LFS_TGT:?LFS_TGT não definido}"

    cd "$LFS/sources"

    [[ -f "bash-${BASH_VER}.tar.xz" ]] || [[ -f "bash-${BASH_VER}.tar.gz" ]] || {
        echo "ERRO: bash-${BASH_VER}.tar.[xz|gz] não encontrado em $LFS/sources" >&2
        exit 1
    }

    tar -xf "bash-${BASH_VER}.tar."*
    cd "bash-${BASH_VER}"

    ./configure --prefix=/usr                      \
                --build="$(sh support/config.guess)" \
                --host="$LFS_TGT"                  \
                --without-bash-malloc

    make
    make DESTDIR="$LFS" install

    # Link /bin/sh → bash (em $LFS)
    ln -svf ../usr/bin/bash "$LFS/bin/sh"

    cd "$LFS/sources"
    rm -rf "bash-${BASH_VER}"
}

#######################################################
# Checagem genérica
#######################################################

# Principais: bash e /bin/sh
PKG_MAIN_BINS=(
  "/usr/bin/bash"
  "/bin/sh"
)

PKG_CHECK_CMDS=(
  "$LFS/usr/bin/bash --version"
  "$LFS/bin/sh --version"
)
