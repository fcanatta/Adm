# Coreutils-9.9 - baseado em LFS 6.5 (Coreutils-9.7)
# --------------------------------------------------
# Instala coreutils temporários em $LFS/usr e move chroot para /usr/sbin.
# Variáveis:
#   - COREUTILS_VER, LFS, LFS_TGT

PKG_NAME="coreutils"

PKG_BUILD() {
    set -e

    : "${COREUTILS_VER:?COREUTILS_VER não definido}"
    : "${LFS:?LFS não definido}"
    : "${LFS_TGT:?LFS_TGT não definido}"

    cd "$LFS/sources"

    [[ -f "coreutils-${COREUTILS_VER}.tar.xz" ]] || [[ -f "coreutils-${COREUTILS_VER}.tar.gz" ]] || {
        echo "ERRO: coreutils-${COREUTILS_VER}.tar.[xz|gz] não encontrado em $LFS/sources" >&2
        exit 1
    }

    tar -xf "coreutils-${COREUTILS_VER}.tar."*
    cd "coreutils-${COREUTILS_VER}"

    ./configure --prefix=/usr                     \
                --host="$LFS_TGT"                 \
                --build="$(build-aux/config.guess)" \
                --enable-install-program=hostname \
                --enable-no-install-program=kill,uptime

    make
    make DESTDIR="$LFS" install

    # Ajustes do chroot para /usr/sbin + man8 (como no livro)
    mv -v "$LFS/usr/bin/chroot"              "$LFS/usr/sbin"
    mkdir -pv "$LFS/usr/share/man/man8"
    mv -v "$LFS/usr/share/man/man1/chroot.1" "$LFS/usr/share/man/man8/chroot.8"
    sed -i 's/"1"/"8"/'                      "$LFS/usr/share/man/man8/chroot.8"

    cd "$LFS/sources"
    rm -rf "coreutils-${COREUTILS_VER}"
}

#######################################################
# Checagem genérica
#######################################################

# Principal: ls
PKG_MAIN_BINS=(
  "/usr/bin/ls"
)

PKG_CHECK_BINS=(
  "/usr/sbin/chroot"
  "/usr/bin/cp"
  "/usr/bin/mv"
)

PKG_CHECK_CMDS=(
  "$LFS/usr/bin/ls --version"
  "$LFS/usr/sbin/chroot --version"
)
