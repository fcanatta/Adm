# Gawk-5.3.2 - LFS 6.9
# --------------------
# Variáveis: GAWK_VER, LFS, LFS_TGT

PKG_NAME="gawk"

PKG_BUILD() {
    set -e

    : "${GAWK_VER:?GAWK_VER não definido}"
    : "${LFS:?LFS não definido}"
    : "${LFS_TGT:?LFS_TGT não definido}"

    cd "$LFS/sources"

    [[ -f "gawk-${GAWK_VER}.tar.xz" ]] || [[ -f "gawk-${GAWK_VER}.tar.gz" ]] || {
        echo "ERRO: gawk-${GAWK_VER}.tar.[xz|gz] não encontrado em $LFS/sources" >&2
        exit 1
    }

    tar -xf "gawk-${GAWK_VER}.tar."*
    cd "gawk-${GAWK_VER}"

    # não instalar extras (igual livro)
    sed -i 's/extras//' Makefile.in

    ./configure --prefix=/usr   \
                --host="$LFS_TGT" \
                --build="$(./build-aux/config.guess)"

    make
    make DESTDIR="$LFS" install

    cd "$LFS/sources"
    rm -rf "gawk-${GAWK_VER}"
}

#######################################################
# Checagem genérica
#######################################################

PKG_MAIN_BINS=(
  "/usr/bin/gawk"
)

PKG_CHECK_BINS=(
  "/usr/bin/awk"
)

PKG_CHECK_CMDS=(
  "$LFS/usr/bin/gawk --version"
)
