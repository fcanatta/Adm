# Libstdc++ from GCC-15.2.0 - LFS 5.6
# -----------------------------------
# Usa o tarball do GCC para construir apenas a libstdc++ no $LFS.
# Pré-requisitos:
#   - gcc-pass1, glibc
#   - GCC_VER, LFS, LFS_TGT definidos
# Tarball:
#   $LFS/sources/gcc-${GCC_VER}.tar.xz


PKG_NAME="libstdcpp"

PKG_BUILD() {
    set -e

    : "${GCC_VER:?GCC_VER não definido}"
    : "${LFS:?LFS não definido}"
    : "${LFS_TGT:?LFS_TGT não definido}"

    cd "$LFS/sources"

    [[ -f "gcc-${GCC_VER}.tar.xz" ]] || [[ -f "gcc-${GCC_VER}.tar.gz" ]] || {
        echo "ERRO: gcc-${GCC_VER}.tar.[xz|gz] não encontrado em $LFS/sources" >&2
        exit 1
    }

    tar -xf "gcc-${GCC_VER}.tar."*
    cd "gcc-${GCC_VER}"

    mkdir -v build-libstdc++
    cd build-libstdc++

    ../libstdc++-v3/configure      \
        --host="$LFS_TGT"          \
        --build="$(../config.guess)" \
        --prefix=/usr              \
        --disable-multilib         \
        --disable-nls              \
        --disable-libstdcxx-pch    \
        --with-gxx-include-dir="/tools/$LFS_TGT/include/c++/${GCC_VER}"

    make
    make DESTDIR="$LFS" install

    cd "$LFS/sources"
    rm -rf "gcc-${GCC_VER}"
}

#######################################################
# Checagem genérica
#######################################################

# Libstdc++ é biblioteca, então foco em libs
PKG_CHECK_LIBS=(
  "/usr/lib/libstdc++.so.6"
  "/usr/lib/libstdc++.a"
)

# Também checamos se o cross g++ existe (binário)
PKG_CHECK_BINS=(
  "/usr/bin/${LFS_TGT}-g++"
)

# Comandos simples no host usando o tree do $LFS
PKG_CHECK_CMDS=(
  "$LFS/usr/bin/${LFS_TGT}-g++ --version"
)
