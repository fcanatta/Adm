#!/usr/bin/env bash
# hook: pre_build para musl (libc do sistema)
# Aqui é para o rootfs final baseado em musl (dentro do chroot).

set -eu

: "${ADM_INSTALL_ROOT:=/}"
: "${ADM_BUILD_SRC_DIR:?}"
: "${ADM_BUILD_BUILD_DIR:?}"

mkdir -p "${ADM_BUILD_BUILD_DIR}"

# musl vai instalar libs em /lib e includes em /usr/include
export ADM_BUILD_PREFIX="${ADM_INSTALL_ROOT}/usr"

export ADM_BUILD_CONFIGURE_EXTRA="
  --prefix=/usr
  --syslibdir=/lib
"

# Não força CC: deixa o ambiente/chroot decidir (pode ser gcc-musl ou cc padrão)
export CFLAGS="${CFLAGS:--O2 -pipe}"
