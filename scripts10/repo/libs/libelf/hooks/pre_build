#!/usr/bin/env bash
# hook: pre_build para libelf (elfutils)

set -eu

: "${ADM_INSTALL_ROOT:=/}"
: "${ADM_BUILD_SRC_DIR:?}"
: "${ADM_BUILD_BUILD_DIR:?}"

mkdir -p "${ADM_BUILD_BUILD_DIR}"
cd "${ADM_BUILD_BUILD_DIR}"

export ADM_BUILD_PREFIX="${ADM_INSTALL_ROOT}/usr"

# deixa o driver de build do ADM rodar o configure/make,
# só injetamos opções específicas
../configure \
  --prefix=/usr \
  --disable-debuginfod \
  --disable-libdebuginfod \
  --disable-nls \
  --enable-libdebuginfod=no || {
    echo "[libelf] configure falhou" >&2
    exit 1
  }

export ADM_BUILD_CONFIGURE_EXTRA=""   # já configurado acima, só usa make/make install
