#!/usr/bin/env bash
# hook: pre_build para bzip2
# bzip2 usa Makefile próprio; aqui só acertamos prefix e flags.

set -eu

: "${ADM_INSTALL_ROOT:=/}"
: "${ADM_BUILD_SRC_DIR:?}"
: "${ADM_BUILD_BUILD_DIR:?}"

mkdir -p "${ADM_BUILD_BUILD_DIR}"

export ADM_BUILD_PREFIX="${ADM_INSTALL_ROOT}/usr"

# Para bzip2, o driver 'make-only' ou equivalente do detect/build
# deve respeitar PREFIX/DESTDIR. Aqui só setamos flags.
export ADM_BUILD_CONFIGURE_EXTRA=""

export CFLAGS="${CFLAGS:--O2 -pipe}"
export CXXFLAGS="${CXXFLAGS:--O2 -pipe}"
