#!/usr/bin/env bash
# hook: pre_build para openssl
# Ajusta prefix/dir padr찾o; build real fica a cargo do detect/build.

set -eu

: "${ADM_INSTALL_ROOT:=/}"
: "${ADM_BUILD_SRC_DIR:?}"
: "${ADM_BUILD_BUILD_DIR:?}"

mkdir -p "$ADM_BUILD_BUILD_DIR"

# OpenSSL instala em /usr
export ADM_BUILD_PREFIX="${ADM_INSTALL_ROOT}/usr"

# OpenSSL usa ./Configure pr처prio, mas seu detect.sh trata isso;
# aqui s처 ajustamos diret처rios.
export ADM_BUILD_CONFIGURE_EXTRA="
  --prefix=/usr
  --openssldir=/etc/ssl
  shared
  zlib
"

# Flags seguros
export CFLAGS="${CFLAGS:--O2 -pipe}"
export CXXFLAGS="${CXXFLAGS:--O2 -pipe}"
