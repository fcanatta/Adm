#!/usr/bin/env bash
# hook: pre_build para binutils-pass2
# Usa o sysroot de ${ADM_CROSS_ROOT} com libc j√° instalada (glibc ou musl).

set -eu

: "${ADM_ROOT:=/usr/src/adm}"
: "${ADM_CROSS_ROOT:=$ADM_ROOT/cross-tools}"
: "${ADM_TARGET:=x86_64-linux-gnu}"

: "${ADM_BUILD_SRC_DIR:?}"
: "${ADM_BUILD_BUILD_DIR:?}"

mkdir -p "$ADM_BUILD_BUILD_DIR"

export ADM_BUILD_PREFIX="${ADM_CROSS_ROOT}"

export ADM_BUILD_CONFIGURE_EXTRA="
  --target=${ADM_TARGET}
  --prefix=${ADM_CROSS_ROOT}
  --with-sysroot=${ADM_CROSS_ROOT}
  --with-lib-path=${ADM_CROSS_ROOT}/lib
  --disable-nls
  --enable-gold
  --enable-ld=default
"

export PATH="${ADM_CROSS_ROOT}/bin:${PATH}"
export CFLAGS="${CFLAGS:--O2 -pipe}"
export CXXFLAGS="${CXXFLAGS:--O2 -pipe}"
