#!/usr/bin/env bash
# hook: pre_build para gcc-pass2
# Objetivo:
#   - GCC final para o alvo, com libstdc++ e demais libs padr√£o
#   - Usa glibc em ${ADM_CROSS_ROOT}/${ADM_TARGET}

set -eu

: "${ADM_ROOT:=/usr/src/adm}"
: "${ADM_CROSS_ROOT:=$ADM_ROOT/cross-tools}"
: "${ADM_TARGET:=x86_64-linux-gnu}"

: "${ADM_BUILD_SRC_DIR:?}"
: "${ADM_BUILD_BUILD_DIR:?}"

mkdir -p "$ADM_BUILD_BUILD_DIR"

export ADM_BUILD_PREFIX="${ADM_CROSS_ROOT}"

export ADM_BUILD_CONFIGURE_EXTRA="
  --target=${ADM_TARGET}
  --prefix=${ADM_CROSS_ROOT}
  --with-sysroot=${ADM_CROSS_ROOT}
  --enable-languages=c,c++
  --disable-multilib
  --enable-threads=posix
  --disable-libsanitizer
  --disable-libquadmath
"

export PATH="${ADM_CROSS_ROOT}/bin:${PATH}"
export CFLAGS="-O2 -pipe"
export CXXFLAGS="-O2 -pipe"
