#!/usr/bin/env bash
# hook: pre_build para perl (build REAL com Configure + make + make install)
# Usa ADM_BUILD_SKIP_DEFAULT=1 para pular drivers padrão do build.sh.

set -eu

: "${ADM_INSTALL_ROOT:=/}"
: "${ADM_BUILD_SRC_DIR:?}"

cd "${ADM_BUILD_SRC_DIR}"

# Configure do Perl é diferente de autotools, então fazemos aqui.
sh Configure -des \
  -Dprefix=/usr \
  -Dvendorprefix=/usr \
  -Dprivlib=/usr/lib/perl5/5.42/core_perl \
  -Darchlib=/usr/lib/perl5/5.42/core_perl \
  -Dsitelib=/usr/lib/perl5/5.42/site_perl \
  -Dsitearch=/usr/lib/perl5/5.42/site_perl \
  -Dvendorlib=/usr/lib/perl5/5.42/vendor_perl \
  -Dvendorarch=/usr/lib/perl5/5.42/vendor_perl \
  -Dman1dir=/usr/share/man/man1 \
  -Dman3dir=/usr/share/man/man3 \
  -Dpager="/usr/bin/less -isR" \
  -Duseshrplib \
  -Dusethreads

make
make install

# Não deixa o build.sh tentar rodar configure/make de novo
export ADM_BUILD_SKIP_DEFAULT=1
