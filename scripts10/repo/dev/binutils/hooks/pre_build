#!/usr/bin/env bash
# hook: pre_build para binutils (base do sistema)

set -eu

: "${ADM_INSTALL_ROOT:=/}"
: "${ADM_BUILD_SRC_DIR:?}"
: "${ADM_BUILD_BUILD_DIR:?}"

mkdir -p "${ADM_BUILD_BUILD_DIR}"

export ADM_BUILD_PREFIX="${ADM_INSTALL_ROOT}/usr"

# Binutils padrão: configure + make. Só ajustamos opções.
export ADM_BUILD_CONFIGURE_EXTRA="
  --prefix=/usr
  --sysconfdir=/etc
  --disable-werror
  --enable-gold
  --enable-ld=default
  --enable-plugins
  --enable-shared
  --disable-static
  --with-system-zlib
"

export CFLAGS="${CFLAGS:--O2 -pipe}"
export CXXFLAGS="${CXXFLAGS:--O2 -pipe}"
