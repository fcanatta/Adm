Beleza, vamos transformar esse script em algo que voc√™ consegue confiar porque sabe testar tudo.
Vou montar um check-list por fase e depois um bloco s√≥ sobre valida√ß√£o do cross-toolchain com ‚Äúhello world‚Äù, readelf, etc.

Vou assumir:

LFS=/mnt/lfs
LFS_TGT=$(uname -m)-lfs-linux-gnu   # ex: x86_64-lfs-linux-gnu
./lfs-cross-helper.sh               # script j√° est√° execut√°vel


---

0. Antes de tudo ‚Äì checar ambiente do host

0.1. Ver se o host tem as ferramentas b√°sicas

Como root:

for t in bash binutils bison coreutils diff find gawk gcc g++ grep gzip \
         m4 make patch perl python3 sed tar xz wget; do
  command -v "$t" >/dev/null || echo "FALTA: $t"
done

Se aparecer algum FALTA, instala pela distro antes de continuar.

0.2. Testar o script rapidamente

bash -n lfs-cross-helper.sh   # n√£o deve imprimir nada (sintaxe ok)
./lfs-cross-helper.sh         # deve mostrar o usage


---

1. Testes depois de init-host

1.1. Rodar fase

sudo ./lfs-cross-helper.sh init-host

1.2. Conferir estado

sudo ./lfs-cross-helper.sh status

Sa√≠da esperada (algo assim):

[OK]   init-host
[....] download-sources
[....] verify-sources
...

1.3. Conferir layout e permiss√µes

ls -ld /mnt/lfs /mnt/lfs/{tools,usr,var,etc,sources}
id lfs
getent group lfs

Esperado:

/mnt/lfs e subdiret√≥rios existem.

Dono: lfs:lfs.

Usu√°rio lfs existe.


1.4. Testar ambiente do usu√°rio lfs

su - lfs -c 'echo "LFS=$LFS  LFS_TGT=$LFS_TGT"; echo "PATH=$PATH"'

Esperado:

LFS=/mnt/lfs

PATH come√ßa com /mnt/lfs/tools/bin: (ou o valor de $LFS/tools/bin).



---

2. Testes de download-sources e verify-sources

2.1. Rodar download

sudo ./lfs-cross-helper.sh download-sources

Depois:

ls $LFS/sources | head

Tem que ter um monte de .tar.xz, .tar.gz, etc.

2.2. Verificar checksums

sudo ./lfs-cross-helper.sh verify-sources

Se tudo ok:

No final ele mostra FALHOU: 0 e FALTANDO: 0.

status mostra verify-sources como [OK]:


sudo ./lfs-cross-helper.sh status


---

3. Check-list de testes do CROSS-TOOLCHAIN

Rodar:

sudo ./lfs-cross-helper.sh cross-toolchain

Isso vai passar por:

1. Binutils pass 1


2. GCC pass 1


3. Linux headers


4. Glibc ou Musl (dependendo de USE_MUSL)


5. Libstdc++ cross



Se falhar, ele para onde der erro (bom p/ debug).

3.1. Testes espec√≠ficos (como root ou como lfs)

3.1.1. Testar Binutils pass1

Como lfs:

su - lfs

which "$LFS_TGT-as"
which "$LFS_TGT-ld"
"$LFS_TGT-as" --version
"$LFS_TGT-ld" --version
exit

Esperado:

which mostra algo em /mnt/lfs/tools/bin/‚Ä¶.

--version imprime algo tipo GNU assembler (GNU Binutils) 2.45.1 (ou sua vers√£o).


3.1.2. Testar GCC pass1

Ainda como lfs:

su - lfs

which "$LFS_TGT-gcc"
"$LFS_TGT-gcc" --version

# onde est√° o sysroot?
"$LFS_TGT-gcc" -print-sysroot

# diret√≥rios de busca
"$LFS_TGT-gcc" -print-search-dirs
exit

Esperado:

which ‚Üí /mnt/lfs/tools/bin/$LFS_TGT-gcc

-print-sysroot ‚Üí $LFS (ou $LFS + algo), n√£o /.

Nenhum erro de ‚Äúcommand not found‚Äù.


3.1.3. Verificar Linux headers

Como root:

ls -R $LFS/usr/include | head

E confirmar que s√≥ tem .h (sem arquivos estranhos):

find $LFS/usr/include -type f ! -name '*.h'

Esperado: nenhuma linha nessa √∫ltima; s√≥ .h.

3.1.4. Verificar glibc/musl cross

Se estiver usando Glibc (padr√£o):

ls $LFS/usr/lib | egrep "crt1.o|crti.o|crtn.o"   # arquivos de start
ls $LFS/lib                                  # deve ter libc.so, etc. (ou /usr/lib)

Se estiver usando Musl:

ls $LFS/lib | grep "libc.so"

3.1.5. Verificar libstdc++ cross

ls $LFS/usr/lib | grep "libstdc++"
ls $LFS/usr/include/c++/$GCC_VER

(de dentro do script, $GCC_VER = 15.2.0; na shell, substitui direto)


---

3.2. Teste ‚ÄúHello World‚Äù com o cross-compiler

Esse √© o teste mais importante üí•

Como lfs:

su - lfs

cat > hello.c << 'EOF'
#include <stdio.h>

int main(void) {
    printf("Hello LFS cross-toolchain!\n");
    return 0;
}
EOF

"$LFS_TGT-gcc" hello.c -o hello
file hello
"$LFS_TGT-readelf" -l hello | grep 'Requesting program interpreter' || readelf -l hello | grep 'Requesting program interpreter'
exit

O que olhar:

file hello deve dizer algo como:

ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, ...


A linha do readelf mostra qual interpretador (linker din√¢mico) est√° sendo usado ‚Äì voc√™ quer algo compat√≠vel com a glibc/musl que est√° em $LFS, n√£o coisas do host.


> Se voc√™ copiar o hello pra dentro do chroot depois (quando ele existir), ele deve rodar l√° normalmente.




---

4. Check-list de testes das TEMPORARY TOOLS (Cap. 6)

Depois de rodar:

sudo ./lfs-cross-helper.sh temp-tools
sudo ./lfs-cross-helper.sh status   # temp-tools deve estar [OK]

4.1. Verificar se as ferramentas est√£o instaladas em $LFS

Como root:

ls $LFS/usr/bin | egrep 'bash|m4|grep|gawk|sed|tar|xz|gzip|make|patch|find|file'

4.2. Testar algumas delas pelo cross-ambiente (ainda como lfs)

su - lfs

# importantes
$LFS_TGT-gcc --version       # j√° vimos
bash --version               # precisa pegar /usr/bin/bash do $LFS via PATH?
grep --version
sed --version
tar --version
xz --version

exit

Esses comandos, rodados como lfs, v√£o usar o PATH configurado no .bashrc (com $LFS/tools/bin:/usr/bin:/bin).
Como as temporary tools foram instaladas com DESTDIR=$LFS, elas estar√£o em $LFS/usr/bin, e quando voc√™ entrar no chroot, se tornam /usr/bin.


---

5. Testes ap√≥s chroot-setup

Rodar:

sudo ./lfs-cross-helper.sh chroot-setup
sudo ./lfs-cross-helper.sh status   # chroot-setup deve estar [OK]

5.1. Conferir mounts

mount | egrep "$LFS"

Voc√™ deve ver coisas como:

/dev ‚Üí $LFS/dev

proc ‚Üí $LFS/proc

sysfs ‚Üí $LFS/sys

tmpfs ‚Üí $LFS/run

devpts ‚Üí $LFS/dev/pts


5.2. Tentar entrar manualmente no chroot

sudo chroot $LFS /usr/bin/env -i \
    HOME=/root TERM=$TERM PS1='(test) \u:\w\$ ' \
    PATH=/usr/bin:/usr/sbin:/bin:/sbin \
    /usr/bin/bash --login

Dentro do chroot:

echo "Estou no chroot, pwd = $(pwd)"
ls /
ls /usr/bin | head
cat /etc/passwd
cat /etc/group
ls -l /bin /sbin /lib
exit

Esperado:

/bin, /sbin, /lib s√£o symlinks para /usr/bin, /usr/sbin, /usr/lib.

/etc/passwd e /etc/group com o conte√∫do m√≠nimo criado pelo script.

/root, /tmp, /var/tmp existem com as permiss√µes corretas.



---

6. Testes ap√≥s chroot-tools (Cap. 7)

Rodar:

sudo ./lfs-cross-helper.sh chroot-tools
sudo ./lfs-cross-helper.sh status   # chroot-tools deve estar [OK]

6.1. Validar dentro do chroot

Entre no chroot (como acima ou com enter-chroot):

sudo ./lfs-cross-helper.sh enter-chroot

Dentro:

# gettext
which msgfmt && msgfmt --version

# bison
which bison && bison --version

# perl
which perl && perl -v

# python
which python3 && python3 --version

# texinfo
which makeinfo && makeinfo --version

# util-linux (exemplos)
which fdisk && fdisk --version
which mount && mount --version

exit

Se tudo responder com vers√µes ‚Äúnormais‚Äù (sem erro de ‚Äúcommand not found‚Äù), as ferramentas do cap. 7 est√£o ok.


---

7. Final ‚Äì desmontar chroot com seguran√ßa

Quando terminar:

sudo ./lfs-cross-helper.sh umount-chroot
mount | egrep "$LFS"   # n√£o deve sobrar nada

Se reclamar de ‚Äútarget is busy‚Äù, verifique se ainda tem shell/processo no chroot:

ps aux | grep "$LFS" | grep -v grep

Feche o que estiver preso e rode umount-chroot de novo.

################################# Debug e solu√ß√µes #################

Boa, agora a gente entra no modo ‚Äúplaybook de incidentes‚Äù:
se falhar em X, eu vou dizer:

Sintomas t√≠picos

Causas prov√°veis

Comandos pra investigar (onde olhar)

O que fazer pra corrigir


Vou seguir a ordem do script:

1. init-host


2. download-sources


3. verify-sources


4. cross-toolchain (com sub-blocos: binutils, gcc, headers, glibc/musl, libstdc++)


5. temp-tools


6. chroot-setup + phase_chroot_dirs_files


7. chroot-tools


8. enter-chroot / umount-chroot



Quando eu falar ‚Äúrodar fase X‚Äù, √© sempre algo como:

sudo ./lfs-cross-helper.sh NOME-DA-FASE


---

1. Falhas em init-host

1.1. ‚ÄúPrecisa rodar como root.‚Äù

Sintoma

Mensagem no come√ßo: Precisa rodar como root.


Causa prov√°vel

Rodou o script sem sudo/root.


Onde olhar

Nada especial, √© s√≥ o come√ßo do script.

Como corrigir

sudo ./lfs-cross-helper.sh init-host


---

1.2. ‚ÄúSeu sistema host est√° faltando algumas ferramentas...‚Äù

Sintoma

Lista de ferramentas faltando: Falta: gcc, Falta: make, etc.


Causa prov√°vel

Voc√™ est√° em uma distro minimalista (ou container) sem os pacotes de desenvolvimento.


Onde olhar

Teste manual:

for t in bash binutils bison coreutils diff find gawk gcc g++ grep gzip \
         m4 make patch perl python3 sed tar xz wget; do
  command -v "$t" >/dev/null || echo "FALTA: $t"
done

Como corrigir

Instalar os dev-packages equivalentes da sua distro (build-essential, binutils, bison, gawk, etc.).

Depois:


sudo ./lfs-cross-helper.sh init-host


---

1.3. Erros ao criar usu√°rio/grupo lfs

Sintoma

Mensagens de useradd / groupadd reclamando, ou falha depois.


Causas prov√°veis

Usu√°rio lfs j√° existe, mas com home/uid estranhos.

Grupo lfs j√° existe com outro GID, mas isso normalmente n√£o √© fatal.


Onde olhar

id lfs   # ver UID/GID
getent group lfs
ls -ld /home/lfs

Como corrigir

Se estiver muito zoado:

sudo userdel -r lfs 2>/dev/null || true
sudo groupdel lfs 2>/dev/null || true
sudo ./lfs-cross-helper.sh init-host

(Cuidado se esse lfs antigo tiver coisas que voc√™ quer guardar.)


---

2. Falhas em download-sources

2.1. wget n√£o consegue baixar (DNS/internet)

Sintoma

wget: unable to resolve host address.

Ou timeouts.


Causas prov√°veis

Sem internet, DNS quebrado, firewall.


Onde olhar

ping -c 3 www.linuxfromscratch.org
ping -c 3 google.com

Como corrigir

Arrumar conectividade.

Depois:


sudo ./lfs-cross-helper.sh download-sources


---

2.2. Arquivos faltando na wget-list

Sintoma

wget d√° erro 404 ou ‚ÄúNot Found‚Äù para alguns arquivos.


Causa prov√°vel

Mudan√ßa no espelho da LFS, ou vers√£o ‚Äúdevelopment‚Äù diferente do script.


Onde olhar

Abra o arquivo de lista:


sed -n '1,40p' $LFS/sources/wget-list

Veja quais URLs est√£o quebrando (pelo output do wget).


Como corrigir

Baixar manualmente o tarball faltando de outro mirror e colocar em $LFS/sources.

(Em caso extremo: ajustar a vers√£o nas vari√°veis do topo do script e dar match com os novos nomes da wget-list.)



---

3. Falhas em verify-sources

3.1. md5sums n√£o encontrado

Sintoma

Mensagem: Arquivo md5sums n√£o encontrado em $LFS/sources. Rode primeiro: download-sources


Causa prov√°vel

N√£o rodou download-sources, ou ele falhou.


Onde olhar

ls $LFS/sources/md5sums

Como corrigir

sudo ./lfs-cross-helper.sh download-sources
sudo ./lfs-cross-helper.sh verify-sources


---

3.2. FALHOU > 0 ou FALTANDO > 0

Sintoma

No final da verifica√ß√£o, o script mostra FALHOU ou FALTANDO > 0.


Causas prov√°veis

Download corrompido.

Arquivo n√£o foi baixado.


Onde olhar

grep FAILED $LFS/sources/md5sum.log || echo "Sem FAILED"
awk '{print $2}' $LFS/sources/md5sums | while read f; do
  [ -f "$LFS/sources/$f" ] || echo "FALTANDO: $f"
done

Como corrigir

Para arquivos com FAILED: apagar e baixar de novo:


cd $LFS/sources
rm -f NOME-DO-ARQUIVO.tar.xz
# rodar download-sources ou baixar manual
sudo ./lfs-cross-helper.sh download-sources
sudo ./lfs-cross-helper.sh verify-sources

Para arquivos faltando: mesma coisa.



---

4. Falhas em cross-toolchain

Essa √© a mais sens√≠vel. Vou quebrar em sub-blocos.

4.1. Falhas em build_binutils_pass1

Sintomas comuns

configure: error: C compiler cannot create executables

No acceptable C compiler found in $PATH

Erros esquisitos logo ap√≥s ../configure em binutils.


Causas prov√°veis

GCC do host quebrado.

PATH do lfs n√£o est√° como o script espera.

tar -xf binutils-... n√£o achou o arquivo.


Onde olhar

Como lfs:

su - lfs
echo "PATH=$PATH"
gcc --version
ls $LFS/sources/binutils-*.tar.xz
exit

Como corrigir

Se gcc n√£o existe ou falha:

Instalar gcc + toolchain da distro.


Se n√£o tem o tarball:

Baixar de novo o binutils-$BINUTILS_VER.tar.xz pra $LFS/sources.



Depois, como root:

sudo ./lfs-cross-helper.sh cross-toolchain

(Sim, ele vai passar por tudo de novo. Se j√° existirem restos, o script limpa o diret√≥rio do pacote no final.)


---

4.2. Falhas em build_gcc_pass1

Sintomas comuns

Reclama de MPFR, GMP, MPC: configure: error: ... mpfr ...

Erro em sed do t-linux64 (alguma mensagem tipo ‚ÄúNo such file or directory‚Äù).


Causas prov√°veis

Tarballs de mpfr, gmp, mpc n√£o existem no $LFS/sources.

Vers√µes diferentes das que est√£o nas vari√°veis do topo.

Estrutura do GCC diferente daquela que o sed espera (mudou de vers√£o).


Onde olhar

ls $LFS/sources | egrep 'gcc-|mpfr-|gmp-|mpc-'

Verque est√£o com os nomes:

gcc-$GCC_VER.tar.xz

mpfr-$MPFR_VER.tar.xz

gmp-$GMP_VER.tar.xz

mpc-$MPC_VER.tar.gz


Como corrigir

Garantir que os nomes batem com as vari√°veis do topo do script.

Se baixou vers√µes diferentes, ou:

Ajusta as vari√°veis (GCC_VER, MPFR_VER, etc.)

Ou renomeia os arquivos para o padr√£o esperado.


Se o sed der erro em gcc/config/i386/t-linux64, ver se o caminho existe:


tar -tf $LFS/sources/gcc-$GCC_VER.tar.xz | grep 'gcc/config/i386/t-linux64'

Se n√£o existir (mudan√ßa de layout no GCC), pode comentar o bloco case x86_64) temporariamente.


---

4.3. Falhas em build_linux_headers

Sintomas

make headers falha.

tar -xf linux-... reclamando de ‚Äúarquivo n√£o encontrado‚Äù.


Causas prov√°veis

Tarball do kernel ausente ou corrompido.

make/toolchain do host com problema.


Onde olhar

ls $LFS/sources/linux-$LINUX_VER.tar.xz

Dentro do build (se quiser depurar):

su - lfs
cd $LFS/sources
tar -xf linux-$LINUX_VER.tar.xz
cd linux-$LINUX_VER
make mrproper
make headers
# ver erros

Como corrigir

Se o tarball estiver quebrado: apagar e baixar de novo.

Se make headers der erro de compila√ß√£o, normalmente √© bug do kernel/vers√£o; validar se est√° usando a vers√£o certa e se o host tem toolchain OK.



---

4.4. Falhas em build_glibc_cross (quando USE_MUSL=0)

Sintomas

configure: error: ... sobre ld, gcc, headers.

Mensagens envolvendo __stack_chk_fail, ld-linux, etc.


Causas prov√°veis

build_linux_headers n√£o rodou corretamente (sem includes em $LFS/usr/include).

binutils/gcc pass1 n√£o est√£o no PATH do lfs.

Erro de vers√£o incompat√≠vel.


Onde olhar

ls $LFS/usr/include | head
su - lfs -c 'echo $PATH; which "$LFS_TGT-gcc"; which "$LFS_TGT-ld"'

No diret√≥rio de build da glibc (se quiser depurar):

su - lfs
cd $LFS/sources
tar -xf glibc-$GLIBC_VER.tar.xz
cd glibc-$GLIBC_VER
mkdir build && cd build
../configure ...   # repetir os args que est√£o no script

Como corrigir

Garantir que linux_headers rodou OK (headers .h est√£o em $LFS/usr/include).

Ver se LFS_TGT-gcc e LFS_TGT-ld est√£o no PATH do lfs.

Confirmar que a vers√£o do tarball bate com GLIBC_VER.



---

4.5. Falhas em build_musl_cross (quando USE_MUSL=1)

Sintomas

Erro ao aplicar patch (patch: ****) se os arquivos de patch n√£o existem.

./configure falha reclamando do CROSS_COMPILE ou do target.


Causas prov√°veis

N√£o baixou os patches de seguran√ßa, mas eles est√£o referenciados (hoje o script trata isso e s√≥ aplica se existir, ent√£o N√ÉO deveria quebrar).

LFS_TGT-gcc n√£o est√° funcional.

Tarball musl-$MUSL_VER.tar.gz n√£o existe.


Onde olhar

ls $LFS/sources | egrep 'musl-1.2.5|iconv'
su - lfs -c 'which "$LFS_TGT-gcc"; "$LFS_TGT-gcc" --version'

Como corrigir

Se o tarball musl estiver faltando, baixar para $LFS/sources.

Se o gcc cross ainda n√£o est√° OK, resolver problemas em binutils/gcc_pass1 primeiro (ver se cross-toolchain j√° andou at√© a√≠).



---

4.6. Falhas em build_libstdcpp_cross

Sintomas

configure: error: C++ compiler cannot create executables ou algo sobre includes.

tar -xf gcc-... n√£o acha o arquivo (porque j√° foi apagado numa tentativa anterior).


Causas prov√°veis

Tarball do GCC foi removido e n√£o baixou de novo.

LFS_TGT-gcc + glibc/musl ainda n√£o est√£o OK.

--with-gxx-include-dir apontando para um caminho que n√£o existe.


Onde olhar

ls $LFS/sources/gcc-$GCC_VER.tar.xz
su - lfs -c 'which "$LFS_TGT-gcc"; "$LFS_TGT-gcc" --version'
ls $LFS/tools/$LFS_TGT/include/c++/$GCC_VER

Como corrigir

Garantir que o tarball gcc-$GCC_VER.tar.xz est√° em $LFS/sources.

Confirmar que LFS_TGT-gcc funciona (hello world da se√ß√£o 3.2).

Se tools/$LFS_TGT/include/c++/$GCC_VER n√£o existir, talvez GCC pass1 n√£o instalou direito ‚Üí revisar erros anteriores.



---

5. Falhas em temp-tools

Aqui normalmente quebra em:

tar -xf (arquivo faltando)

./configure (layout diferente, host sem toolchain, falta de depend√™ncias)


5.1. ‚ÄúArquivo n√£o encontrado‚Äù ao extrair tarball

Sintomas

tar: arquivo.tar.xz: Cannot open: No such file or directory


Causa prov√°vel

wget-list tinha outra vers√£o; voc√™ ajustou as vari√°veis mas n√£o o nome do arquivo, ou vice-versa.


Onde olhar

ls $LFS/sources | egrep 'm4-|ncurses-|bash-|coreutils-|diffutils-|file-|findutils-|gawk-|grep-|gzip-|make-|patch-|sed-|tar-|xz-'

Como corrigir

Garantir que as vers√µes nas vari√°veis do topo batem com os arquivos em $LFS/sources, ou renomear manualmente os arquivos.

Exemplo:


mv m4-1.4.21.tar.xz m4-1.4.20.tar.xz   # se a vari√°vel ainda estiver 1.4.20

(Ideal √© sempre ajustar as vari√°veis se mudar a vers√£o.)


---

5.2. ./configure reclama de host/build

Sintomas

configure: error: cannot guess build type; you must specify one

build-aux/config.guess: No such file or directory


Causas prov√°veis

Vers√£o do pacote diferente; o caminho build-aux/config.guess n√£o existe.

O script usa ./config.guess e a vers√£o mudou.


Onde olhar

Dentro do pacote (exemplo m4):

su - lfs
cd $LFS/sources
tar -xf m4-$M4_VER.tar.xz
cd m4-$M4_VER
find . -name 'config.guess'
exit

Como corrigir

Ajustar a linha do script que chama config.guess pro caminho correto daquela vers√£o.

Se hoje est√° build-aux/config.guess e o arquivo est√° em ./config.guess, trocar.


Re-executar temp-tools.



---

5.3. ‚Äúpermission denied‚Äù instalando em $LFS

Sintomas

make DESTDIR=$LFS install falha com Permission denied escrevendo em $LFS/usr/....


Causas prov√°veis

chroot-setup foi rodado cedo demais (root virou dono de tudo antes de terminar temp-tools).


Onde olhar

ls -ld $LFS $LFS/usr $LFS/tools

Se o dono for root:root antes da hora, √© isso.

Como corrigir

Se ainda est√° em fase de build (antes do chroot setup):

sudo chown -R lfs:lfs $LFS
sudo ./lfs-cross-helper.sh temp-tools


---

6. Falhas em chroot-setup / phase_chroot_dirs_files

6.1. Erros de mount (j√° montado, etc.)

Sintomas

mount: /mnt/lfs/dev: mount point does not exist
ou

mount: /mnt/lfs/dev: already mounted (se fizesse manual)


Causas prov√°veis

$LFS n√£o existe.

Voc√™ j√° montou algo manualmente.


Onde olhar

ls -ld $LFS $LFS/dev $LFS/proc $LFS/sys $LFS/run
mount | egrep "$LFS"

Como corrigir

Garantir que $LFS existe (init-host).

Se tiver montagens antigas zoadas, pode desmontar com:


sudo ./lfs-cross-helper.sh umount-chroot

e rodar chroot-setup de novo.


---

6.2. Falha dentro do chroot na cria√ß√£o de diret√≥rios ou arquivos (7.5/7.6)

Sintomas

Erro em phase_chroot_dirs_files, algo como:

ln: failed to create symbolic link '/bin': File exists

rm: cannot remove '/bin': Device or resource busy



Causas prov√°veis

Voc√™ j√° entrou no chroot e criou coisas manualmente.

/bin, /sbin, /lib n√£o s√£o diret√≥rios esperados (por exemplo, j√° s√£o symlinks).


Onde olhar

Dentro do chroot (manual):

sudo chroot $LFS /usr/bin/env -i HOME=/root PATH=/usr/bin:/bin \
  /usr/bin/bash -c 'ls -ld /bin /sbin /lib'

Como corrigir

Se for safe: remover manualmente /bin, /sbin, /lib dentro do chroot e rodar chroot-setup de novo:


sudo chroot $LFS /usr/bin/env -i HOME=/root PATH=/usr/bin:/bin \
  /usr/bin/bash -c 'rm -rf /bin /sbin /lib'
sudo ./lfs-cross-helper.sh chroot-setup

(S√≥ fa√ßa isso se tiver certeza que est√° mexendo no sistema LFS, n√£o no host!)


---

7. Falhas em chroot-tools

7.1. Tarball n√£o encontrado dentro do chroot

Sintoma

tar: gettext-0.26.tar.xz: Cannot open: No such file or directory.


Causa prov√°vel

Arquivo n√£o est√° em $LFS/sources.

Nome diferente da vers√£o nas vari√°veis.


Onde olhar

ls $LFS/sources | egrep 'gettext-|bison-|perl-|Python-|texinfo-|util-linux-'

Como corrigir

Nomear/baixar os arquivos corretos em $LFS/sources conforme as vari√°veis GETTEXT_VER, BISON_VER, etc.

Rodar:


sudo ./lfs-cross-helper.sh chroot-tools


---

7.2. configure falha por falta de toolchain

Sintoma

Dentro de algum pacote no chroot: configure: error: C compiler cannot create executables etc.


Causas prov√°veis

Cross-toolchain ou temp-tools incompletos.

PATH dentro do chroot n√£o cont√©m /usr/bin e /bin corretamente.


Onde olhar

Dentro do chroot:

sudo chroot $LFS /usr/bin/env -i HOME=/root PATH=/usr/bin:/bin \
  /usr/bin/bash -c 'cc --version; ld --version; echo PATH=$PATH'

Como corrigir

Conferir se as fases cross-toolchain e temp-tools est√£o [OK]:


sudo ./lfs-cross-helper.sh status

Se n√£o, resolver os erros dessas fases primeiro (ver se√ß√µes acima).



---

8. Falhas em enter-chroot / umount-chroot

8.1. enter-chroot falha: /bin/bash: No such file or directory

Sintoma

chroot: failed to run command '/bin/bash': No such file or directory


Causas prov√°veis

chroot-setup n√£o rodou por completo.

bash n√£o foi instalado (problema em temp-tools / bash).

Symlinks /bin ‚Üí /usr/bin n√£o existem.


Onde olhar

ls -ld $LFS/bin $LFS/usr/bin/bash

Como corrigir

Garanta que temp-tools e chroot-setup est√£o [OK]:


sudo ./lfs-cross-helper.sh status

Se faltarem symlinks, rodar chroot-setup de novo.



---

8.2. umount-chroot falha: target is busy

Sintoma

umount: /mnt/lfs/dev: target is busy (ou qualquer um dos pontos)


Causas prov√°veis

Shell ou processo ainda usando $LFS (por exemplo, voc√™ ainda est√° dentro do chroot em outro terminal).


Onde olhar

ps aux | grep "$LFS" | grep -v grep
lsof | grep "$LFS"   # se tiver lsof instalado no host

Como corrigir

Fechar todos os terminais/shells que estejam dentro do chroot.

Matar qualquer processo pendurado.

Rodar de novo:


sudo ./lfs-cross-helper.sh umount-chroot
